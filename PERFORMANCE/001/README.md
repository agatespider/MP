# 성능 기초

# 1. 성능이란
시스템에서 성능이란 시간당 처리량을 뜻 한다. 영향을 미치는 요소는 응답시간과 동시에 처리할 수 있는 프로세스들의 숫자이다.

## 1.1 관련 용어

### 1.1.1 동시 사용자
뜻은 2가지 이다. 그렇기에 상황에 따라 어떤 것을 동시 사용자로 말하는지 잘 파악해야 한다.
1. 시스템과 접속을 유지하고 있는 사용자 수
2. 일정시점에 시스템에 트랜잭션을 유발시키는 사용자 수.

공식으로는 동시 사용자수 = 요청 사용자 수 + 비요청 사용자 수

요청 사용자 : 대상 서버에 부하를 발생시키는 사용자로 서버에 요청후 응답을 기다리는 사용자
비요청 사용자 : 서버에 요청을 하지 않고 응답받은 화면만 읽고 있는 사용자

### 1.2 처리량
처리량이란 서버가 일정시간 내에 처리한 트랜잭션의 양을 뜻한다.

1. TPS : 고객의 업무 처리 건수가 초당 얼마나 처리되었는지를 뜻한다.
2. PPS : 페이지단위(화면단위) 처리 건수가 초당 얼마나 되었는지를 뜻한다.
3. HPS : 이미지, 스크립트, css파일 등 모든 리소스를 별개의 요청으로 처리하고 각각이 초당 몇개나 처리 되었는지를 뜻한다.

일반적인 시스템은 최대 500TPS가 일반적이며 금융권이나 통신사는 1000TPS가 넘어야 한다.

### 1.3 응답시간
응답시간은 요청후 응답을 받는데 까지 걸리는 시간을 뜻한다.

1. 클라이언트 응답시간 : 사용자가 요청한 후 화면에 응답이 나타날 때까지 경과된 시간을 의미한다. 보통 클라이언트로직처리시간 + 화면 렌더링시간으로 세분화 한다.
2. 네트워크 응답시간 : 요청이 클라이언트 네트워크에서 전송된 후 부터 응답이 클라이언트 네트워크에 도착하는데 걸리는 시간 보통 DNS룩업시간 + 서비스 업로드/다운로드 으로 세분화 한다. (로드런너 사용)
3. 서버 응답시간 : 서버가 요청을 받은후 처리결과를 내보내는 데까지 걸리는 시간. 보통 웹 엑세스로그나 어플리케이션의 로그를 통해 측정한다. 보통 웹서버처리시간 + 웹어플리케이션처리시간 + 데이터베이스 처리시간으로 세분화 한다.(APM도구 사용)
4. 연계 응답시간 : 외부기관이나 타시스템과 연계시 연계서버에 요청후 응답받는 데까지 걸리는 시간

당연하지만 이 모든 응답시간이 작을 수록 좋은 성능을 내고 있다고 볼 수 있다. 성능을 위한다면 각각의 세분화된 항목들도 측정할 수 있는 방안을 수립하는 것이 선행되어야 한다.

응답시간은 불규칙하게 발생되는 확률이 높기에 보통 백분율 응답시간을 사용한다.

백분율응답시간 : 측정시간동안 100개의 트랜잭션이 발생했고 그에 대한 응답시간 정보가 있을때 가장 빠른 것부터 줄을 세워서 90등 80등을 기록한 트랜잭션의 응답시간을 기준으로 잡는 방식.

퍼샌트를 머로 잡을지는 각 프로젝트마다 다르다. 핵심 기간계 같은 곳은 95%로 응답시간을 잡고 보통 90%로 잡는게 일반적이다. 
 
그런데 100%로 잡지 않는 이유는 특정상황으로 항상1초걸리던것이 10초 20초 걸리는 케이스 때문에 그렇다. 보통 시스템의 자원의 순간적인 부족등의 이유로 발생된다.

### 1.4 자원
자원이란 서버의 CPU, 메모리, 디스크, 네트워크부터 WAS의 Thread pool, DB Connection pool, Heap Memory, DB의 최대 자원수, 오픈가능한 커서수, 공유 캐시 메모리 등등 물리적 자원부터 시스템소프트웨어의 자원까지 다 포함해서 말한다.

성능측면에서 자원은 한정된 자원을 바탕으로 부족한경우나 사용량 변화에 따라 성능에 어떤 영향을 끼치는지를 의미한다.

#### 1.4.1 적정성(Suitability)
적정성이란 각 자원의 부족 여부를 판단시 다른 자원과의 상관관계와 연관관계를 파악하고 평가 해아한다는 의미이다. 보통 자원이 모자르면 경합과 대기가 발생해 성능이 저하되지만 적절하지 못한 자원의 증가는 개선 효과를 보지 못할 수 있으니 확인해야 한다는 의미이다.

예를 들어 Was의 Thread Pool이 모잘라 새로운 요청들이 큐잉지연(Queuing Delay)될 경우 Thread Pool 갯수를 늘려주면 된다고 생각하지만 그렇지 않다.

CPU나 Java Heap Memomy나 인프라 자원의 상태, 어플리케이션의 Lock, DB저성능 쿼리 존재 여부등과 같은 어플리케이션의 상태를 종합적으로 판단해야한다.

CPU 사용량이 90% 이상이라면 Thread Pool을 늘려봣자 별 소용이 없을 것이다. 차라리 Thread Pool을 줄여서 70%이내로 만드는 것이 성능에 더 도움이 될 수도 있다.

#### 1.4.2 효율성
동일업무를 처리하는 두가지 아키텍쳐가 있을 경우. 평가 기준은 TPS와 응답시간이 핵심이지만 동일한 TPS나 응답시간에 있어 얼마나 자원을 효율적으로 쓰는지 판단하라는 의미이다.

보통 BMT(Benchmark Test)의 성능 비교 평가에서 중요 평가 지표로 사용한다.

#### 1.4.3 안정성(Stability)
시스템 운영시간이 지남에 따라 성능이 저하되거나 장애가 발생하는 등의 문제가 발생하면 안된다는 의미이다.

메모리나 DB Connection에 누수가 있다면 어플리케이션을 재기동하지 않는한 언젠간 해당 자원 부족으로 장애가 발생할 것이고 성능상에 문제가 발생할 것이다.

시스템에 일정한 부하가 발생시 시간이 지나더라도 응답시간이나 자원사용량이 일정한지에 대한 안정성 평가다.

#### 1.4.4 가용성(Availability)
가용성이란 일정기간(년)동안 시스템이 정상적으로 서비스된 시간 비율을 의미한다.

금융권이나 쇼핑몰 등 계속 서비스가 되어야 하는 곳은 장애가 즉 손실이기때문에 100%에 가까운 가용성을 유지하고 자 한다. 그리고 보통 이중화 구성이나 DR 구측 등에 신경을 쓴다.

이중화만 한다고해서 가용성이 향상되는건 아니다. 대부분 서버가 동작상태이므로 자원에 여유가 있어야 한다. 중요한건 일부 장비의 장애로 가용자원이 줄어든다 하더라도 정상적인 서비스가 이루어져야 한다는 것이다.

#### 1.4.5 확장성(Scalability)
향후 시스템 증설시 각 자원이 얼마나 용이하게 증설될 수 있는지를 평가하는 것이다.

수직확장 : 현재 사용중인 서버의 자원을 증설하는것.
수평확장 : 서버의 댓수를 늘리는 것.

수직확장은 서버가 얼마나 많은 자원을 넣을수 있는지에 대해서 확인해야하며 수평확장은 서버에서 사용하는 소프트웨어가 수평확장을 지원하는지를 확인해야한다.

# 2. 성능 특성
![성능곡선](https://github.com/agatespider/MP/blob/master/PERFORMANCE/001/img/perfomanceline.PNG)

일반적으로 동시요청자 수에 따른 TPS를 성능 지표로 많이 측정한다. 

동시 요청 사용자수를 계속 증가하면서 TPS와 응답시간을 측정해보면 위와같은 곡선이 그려진다. Saturation Point(포화지점)에서 부터는 더 이상 TPS가 병목형상등의 이유로 증가하지 못한다. 그래서 보통 저지점을 대상 시스템의 최대 성능으로 평가한다.
   
## 2.1 성능 특징
1. 성능은 업무와 시스템 특성에 따라 다르다.
2. 모든 시스템에 일괄 적용할 수 있는 응답시간의 기준은 없고 100% 만족시킬 수도 없다.
3. 동시 사용자 수가 시스템 성능을 의미하진 않는다.
4. 시스템 성능은 비용과 수익으로 평가할 수 있다.

 
