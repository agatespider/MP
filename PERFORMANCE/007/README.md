# 웹 기산 시스템 성능 개선

# 1. 화면 컨텐츠 구성 체크
서버의 응답시간이 느린경우도 많지만 리소스(이미지, 자바스크립트, 스타일시트)들이 무분별하게 많거나 커서 느린 경우도 있다.

이럴 경우는 화면을 간결하게 구성하거나 컨텐츠를 통합하거나 아니면 컨텐츠 용량을 줄이거나 압축을 해야한다.

## 1.1 컨텐츠 수 축소
예전에 비해 브라우저들이 웹서버와 동시 연결해서 다운로드 하는 연결 수가 늘긴 했지만 무수히 많은 컨텐츠 수는 느린응답시간을 제공해주게 된다.

브라우저별 최대 연결수는 [여기](http://www.browserscope.org/)에서 확인 하면 된다.

### 1.1.1 이미지
첫번째 방법은 개별 이미지를 사용해서 각각 화면을 표시하지말고 가능하다면 이미지를 1개의 이미지로 통합해서 구성하면 서버 요청수가 1번만 호출되니 성능개선에 도움이 된다.
또한 이미지 스프라이트를 사용해서 통합된 이미지파일의 여러 이미지를 개별이미지처럼 사용할 수 있다.

두번째는 화면에서 사용하는 이미지파일의 크기를 확정하는 것인데, 1000 X 1000이미지를 100 X 100으로 표현해주면 비효율적이다. 그리고 1000X1000보다 100X100이 용량이 적을 것은 당연하다.

### 1.1.2 자바스크립트
이미지와 마찬가지로 자바스크립트도 여러 js파일로 따로 빼지말고 통합화 한다.

### 1.1.3 사용하지 않는 컨텐츠 제거
당연하게도 사용하지 않은 컨텐츠는 모두 제거한다. 그래야만 서버 요청이 줄어들기 때문이다.

### 1.1.4 CDN사용
CDN은 웹서비스 제공자가 웹 서버에 있는 정적 컨텐츠를 인터넷 서비스 제공자 측에 설치된 CDN서버에 미리 저장해두고 클라이언트가 사용시 최적 경로로 컨텐츠를 제공해주는 기술이다.

### 1.1.5 텍스트 컨텐츠 축소
자바스크립트나 CSS같은 TEXT컨텐츠는 YUI Compressor나 JSMin, HTMLCompressor들을 사용해 들여쓰기, 주석, 공백들을 제거해 용량을 줄일 수 있다.
 
### 1.1.6 압축 
네트워크 환경이 열악한 경우 컨텐츠의 크기가 응답시간에 매우 큰 영향을 끼친다. 이럴땐 속도를 위해 압축을 해야한다.

CSS나 자바스크립트 같은 Text컨텐츠는 웹서버에서 제공하는 압축기능을 이용하면 1/10이하로 크기를 줄일 수 있다, 하지만 압축은 서버의 CPU를 사용하기 때문에 웹서버에 자원이 여유가 있고 전체 응답시간에 네트워크가 차지하는 비중이 클때만 사용해야 한다.

참고로 압축되어있는 컨텐츠를 또 압축해도 큰 차이는 별로 없다.

압축의 동작은 브라우저가 처리할 수 있는 압축 방식을 요청 헤더에 Accept-Encoding: gzip, deflate와 같이 담아서 요청한다.

그러면 서버는 설정된 압축 방식과 브라우저가 처리 가능한 압축방식을 검토해 가능하면 압축해서 보내고 응답해더에 Content-Encoding: deflate와 같이 사용한 압축 방식을 브라우저에 전달한다.

#### 1.1.6.1 nginx 압축 설정

    gzip  on;
    # 파일을 압축하기 위한 최소 파일 크기
    gzip_min_length 1100;
    # gzip 버퍼 크기, 4 32k 면 대부분 상황에서 적당한 크기 입니다.
    gzip_buffers 4 32k;
     # 압축을 적용할 파일타입. 파일타입은 MIME 타입을 말함.
    gzip_types text/plain application/x-javascript text/xml text/css;
    # 압축률 지정. 1 ~ 9 사이이며 9가 최고등급의 압축.
    gzip_comp_level 1;

### 1.1.7 웹가속기 사용
웹서버 앞에서 브라우저와의 통신을 최적화 해주는 역할을 한다. 보통 웹 가속기는 컨텐츠압축, 컨텐츠 캐시, 네트워크 연결 관리, SSL가속등의 역할을 한다.

## 1.2 캐시

### 1.2.1 브라우저 캐시
자동으로 브라우저에서 동작하는 캐시이다. 대국민이나 포털과 같이 사용자가 많은 사이트의 경우는 응답크기를 줄이는 캐시 방식 외에 HTTP 요청수를 줄이는 캐시 방식을 추가로 사용한다.

#### 1.2.1.1 HTTP 응답 크기를 줄이는 캐쉬 방식


   
    